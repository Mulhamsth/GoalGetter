@page "/project/{proid:int}/tasks"
@layout ProjectMainLayout
@inject IDialogService DialogService
@inject NavigationManager NavigationManager
<AuthorizeView>
	<Authorized>
		<h3>Tasks for project @proid</h3>


		<div class="container-fluid">
			<div class="row">
				<div class="col-md-6 d-flex align-items-center">
					<MudButton Variant="Variant.Filled" DisableElevation="true" Style="background-color: #0088d3; color: white" Color="Color.Primary" OnClick="@((e) => OpenDialog(maxWidth))">
						+ Task
					</MudButton>

					<Searchbar OnSearchterm="OnTermSearch" />
				</div>
			</div>
		</div>

		<TasksListComponent proid="@proid" searchTerm="@searchterm" />
	</Authorized>
	<NotAuthorized>
		<MudCard>
			<MudCardHeader>
				<CardHeaderContent>
					<MudText Typo="Typo.h6">You are not allowed to access this page.</MudText>
				</CardHeaderContent>
			</MudCardHeader>
			<MudCardContent>
				<MudText Typo="Typo.body2">Please login to see the content.</MudText>

			</MudCardContent>
			<MudCardActions><MudButton OnClick="RedirectToLogin" Color="Color.Info" Variant="Variant.Filled">Login</MudButton></MudCardActions>
		</MudCard>
	</NotAuthorized>
</AuthorizeView>


@code {
    [Parameter]
    public int proid { get; set; }

	public bool _isOpen;
	private string searchterm = "";

	private bool reloadFlag = false;


	private void OnTermSearch(string searchterm)
	{
		this.searchterm = searchterm;
	}

	DialogOptions maxWidth = new DialogOptions() { MaxWidth = MaxWidth.Small, FullWidth = true };

	private void OpenDialog(DialogOptions options)
	{
		var parameter = new DialogParameters { ["ProId"] = proid };
		parameter.Add("OnTaskAdded", HandleTaskAdded);
		DialogService.Show<AddTask>("Add Task", parameter, options);
	}

	private void HandleTaskAdded()
	{
		searchterm = ""; // Optionally, clear the search term to display all projects after adding
		reloadFlag = !reloadFlag;
		StateHasChanged();
	}
	void RedirectToLogin()
	{
		NavigationManager.NavigateTo("/login", true);
	}

}
