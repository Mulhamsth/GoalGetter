@inject IAddPersonUseCase AddPersonUseCase
@inject ISnackbar Snackbar



<EditForm Model="newPerson" OnValidSubmit="SavePerson">
	<DataAnnotationsValidator />
	<MudItem>
		<MudCard>
			<MudCardContent>
				<MudTextField Label="First name" HelperText="Max. 8 characters"
								@bind-Value="newPerson.Firstname" For="@(() => newPerson.Firstname)" />
				<MudTextField Label="Last name" Class="mt-3"
								@bind-Value="newPerson.Lastname" For="@(() => newPerson.Lastname)" />
				<MudTextField Label="Email" Class="mt-3"
								@bind-Value="newPerson.Email" For="@(() => newPerson.Email)" InputType="InputType.Email" />
				<MudTextField Label="Phone number" Class="mt-3"
								@bind-Value="newPerson.Phone" For="@(() => newPerson.Phone)" InputType="InputType.Telephone" />

				<MudFileUpload T="IBrowserFile" Accept=".jpg, .png" FilesChanged="UploadFiles">
					<ButtonTemplate Context="pictureUploadContext">
						<MudIconButton HtmlTag="label"
									   Color="Color.Info"
									   Icon="@Icons.Material.Filled.PhotoCamera"
										for="@pictureUploadContext">
						</MudIconButton>
					</ButtonTemplate>
				</MudFileUpload>

				@if (files.Any())
				{
					<MudText>@files.Last().Name</MudText>
				}

			</MudCardContent>
			<MudCardActions>
				<MudButton ButtonType="ButtonType.Submit" class="btn btn-primary">Save</MudButton>
				<MudButton ButtonType="ButtonType.Button" class="btn btn-primary" @onclick="Cancel">Cancel</MudButton>
			</MudCardActions>
		</MudCard>
	</MudItem>
</EditForm>

@code {

	private Person newPerson = new Person();
	[CascadingParameter] MudDialogInstance MudDialog { get; set; }

	[Parameter]
	public EventCallback<bool> Windowclosed { get; set; }

	private async Task SavePerson()
	{
		StatusReport<EmptyVal> status = await AddPersonUseCase.ExecuteAsync(newPerson);
		Snackbar.Add(status.Reason, status.severity);

		MudDialog.Close(DialogResult.Ok(true));
	}

	void Cancel() => MudDialog.Cancel();


	IList<IBrowserFile> files = new List<IBrowserFile>();
	private void UploadFiles(IBrowserFile file)
	{
		files.Add(file);
		//TODO upload the files to the server
	}
}
