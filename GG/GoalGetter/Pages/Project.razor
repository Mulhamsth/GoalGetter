@page "/project/{ProId:int}"
@inject IViewProjectByIdUseCase ViewProjectByIdUseCase
@layout ProjectMainLayout
@inject ISnackbar Snackbar
@inject NavigationManager NavigationManager
@inject IUpdateProjectUseCase updateProjectUseCase
@inject IRemoveProjectUseCase removeProjectUseCase
@inject IDialogService DialogService

<AuthorizeView>
	<Authorized>
		<MudText Typo="Typo.h2">@project.Name</MudText>
		<MudText>@project.Description</MudText>
		<MudSelect T="ProgressStatus" @bind-Value="@project.status" Label="Select progress status" AnchorOrigin="Origin.BottomCenter" Variant="Variant.Outlined" Clearable>
			@foreach (ProgressStatus status in Enum.GetValues(typeof(ProgressStatus)))
			{
				<MudSelectItem Value="@(status)" />
				OnChangeData();
			}
		</MudSelect>
		<MudButton Variant="Variant.Filled" OnClick="DeleteProject" StartIcon="@Icons.Material.Filled.Delete" Color="Color.Error">Delete</MudButton>

		<!-- Rest of your component code -->
	</Authorized>
	<NotAuthorized>
		<NotAuthorizedMudCard/>
	</NotAuthorized>
</AuthorizeView>

@code {

	[Parameter]
	public int ProId { get; set; }

	private GG.CoreBusiness.Project project = new GG.CoreBusiness.Project();

	protected override async Task OnParametersSetAsync()
	{
		var result = ViewProjectByIdUseCase.ExecuteAsync(this.ProId).Result;
		if (result.Value != null)
			project = result.Value;
		else
		{
			Snackbar.Add(result.Reason, result.severity);
			NavigationManager.NavigateTo("/");
		}
	}

	private ProgressStatus tmp; //needed to not spam projectRepo (close eyes or brain damage might occur)
	private void OnChangeData()
	{
		if(project.status != tmp)
			updateProjectUseCase.ExecuteAsync(ProId);
		tmp = project.status;
	}

	private async Task DeleteProject()
	{
		var parameters = new DialogParameters();
		parameters.Add("ContentText", "Do you really want to delete this Project? This process cannot be undone.");
		parameters.Add("ButtonText", "Delete");
		parameters.Add("Color", Color.Error);

		var options = new DialogOptions() { CloseButton = true, MaxWidth = MaxWidth.ExtraSmall };

		var dialog = await DialogService.Show<ConfirmDialog>("Delete", parameters, options).Result;

		if (!dialog.Cancelled)
		{
			var status = await removeProjectUseCase.ExecuteAsync(ProId);
			Snackbar.Add(status.Reason, status.severity);
			NavigationManager.NavigateTo("/");
		}
	} 


}
